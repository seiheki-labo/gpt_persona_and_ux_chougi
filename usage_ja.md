# 　山姥切長義を性癖と思想と LLM のパフォーマンス全開で稼働させるための JSON セット利用法　　

## 目次

-   [クイックスタート](#クイックスタート)
-   [パッケージ](#パッケージ)
-   [カスタム例](#カスタム例)
-   [テスト方法](#テスト方法)
-   [動作環境](#動作環境)
-   [免責事項](#免責事項)
-   [謝辞](#謝辞)
-   [ライセンス等](#ライセンス等)

## クイックスタート

**【注意】初期状態の内容は完全に私向けであり、各種の配慮はまったくできていない仕様のためオススメはできません**

1. ダウンロードして解凍
2. packages/tests ディレクトリで`npm install`
3. Node.js をインストール済みなら、packages/tests ディレクトリで `node validate.js` を走らせ、構造上問題ないことを確認
4. 問題がないのを確認したら ChatGPT に instruction.json の中身の**コード全部**を貼り付ける

-   本当にこれだけでやるのはおすすめしません  
    （品質は問題ありませんが、完全に私に向けたカスタマイズの内容のため、解釈違いの責任は負えません）
-   本当に微調整ふくめて一切調整しない場合は、最悪 2 と 3 も無視して問題ありませんが、こちらも品質以前に解釈面の理由でおすすめしません。
-   調整やカスタマイズをご検討の方は、手順 3 より前の段階での作業をおすすめします。

## パッケージ

### プロジェクトルート（思想書）

-   README.md ：思想書兼怪文書
-   usage_ja.md ：このファイルです。操作・カスタマイズ・実装方法をそれっぽく記載しています。

### メインファイル (packages 直下)

-   instruction.json ：　この思想書のメインファイル兼設定集。以下にカスタマイズ方法の詳細を記載します。
-   schema.json ：　 instruction.json の**構造設計ファイル**。  
     instruction.json を**構造レベル**（必須項目の追加・削除、型の変更など）で変えた場合は、こちらも更新してください。  
     文章の書き換えや配列要素の増減といった**内容レベルの変更**だけなら、通常は更新不要です。

### 駆動テストファイル （packages/tests）

※このディレクトリの中身は 基本的に編集不要 です。  
うちの GPT 長義に自動生成（vibe coding 的なノリ）で作ってもらったもので、私自身も挙動の全容は把握していません。  
変更する場合は JSON スキーマや検証ロジックを理解し、編集後に `packages/tests/validate.js` を通せるときだけにしてください。  
それ以外の方は本気で勘弁してください。

-   validate.js ：　 JSON ファイルのバリデーションがちゃんとできているか、確認するテスト js ファイル
-   simulate.js ：　想定シナリオルートで発火が確認できるかの簡易ツールです。  
    基本的には私の環境テスト用＆個人的に履歴を残したいための同梱なので、他の環境で動かすには再設定が必要になる場合があります。  
    ※validate.js でちゃんと通ってればパース的には問題ないので、無視していただいて大丈夫です

## カスタム例

### rules オブジェクト

**rules.character_persona**  
LLM（ChatGPT を想定しています）のキャラクター的ペルソナを設定しています。下記のように調整してみてください。

```

    "character_persona": {
      "names": "山姥切長義",
      "job": "刀剣男士",
      "role": ["主(ユーザー)の近侍", "日常的話し相手", "メンタル管理担当"],　//チャット相手として求める役割を入れておくといいです
      "tender_passion": [""],　// キャラ同士の関係性やCP設定を自由に記述できます（※内容は各自の責任で）
      "respect": ["尊敬対象"],　// 歴史や人物を入れるとその話題で熱がこもる仕様
      "speech": {
        "first_person": "俺",　//一人称
        "second_person": { "primary": "主", "secondary": "君" },
                            //GPT→自分での二人称。優先度の高いもの（審神者としての尊称など）をprimary、状況により必要そうなものをsecondaryに
        "tone": [
          "理知的で品のある対等な態度、感情を抑制",
          "理性的だが冷たすぎない",
          "知的でやや風刺的なユーモア" //解釈（＋ちょっとの好み）にあった口調を簡単に、できれば複数要素で置いてみてください。
        ]
      },
      ... }

```

**rules.mandatory**  
常に適用される会話の応答水準

**rules.recommended**  
適用しておくとユーザーがうれしくなるから推奨、な応答内容

**rules.arrow**  
禁止してないよ、GPT がやりたいなって思ったらどうぞ、な内容

**rules.discouraged**  
禁止はしないけど、正直やってほしくないなと思う応答内容

**rules.forbidden**  
いやです、やめて、解釈違いです、な応答内容

**rules.environment**  
基本的にいじらないほうがいいです。タイムゾーン設定など。  
読み込んで欲しい外部 API とかライブラリがあったら設定してみてもいいかもですが、自己責任でどうぞ。

#### 自己責任の追加カスタム例

-   追加カスタム例として、 rules.character_persona に交友関係、敵対関係なども追加してもいいかもです。`"friend": ["後藤藤四郎","道誉一文字"]` など。
-   以降にコードの説明やカスタム例もありますが、JSON ファイルなのでコメント部分は削除してください。

### policy オブジェクト

こちらは「LLM として」どう動くべきかのルール集です。  
たぶんですが、この項目の設定いらないなぁ、という方はカスタム指示とかプロンプトだけで十分な気がします。

**policy.instant_policy**、**policy.telemetry**  
応答のときの「雑な応答」を減らすためのルール。  
大半の方にはなくてもいいと思います。  
とはいえ削除するとどう動くかわからないのと、あったらいろいろ解答精度が（たぶん）上がるので残しています。  
削除してどうなるかはわかりませんが、削除したいかたはしてもいいと思います。

**policy.target**  
ユーザーやそれを基準にした「会話のターゲット（層）」を設定します。  
夢女さんはここにその旨がわかるよう書いてみるのもいいかもしれません。

-   `"audience": "主（平均分布的水準を想定）",`
    ユーザー名とかいれておくといいです。カッコでの内容はあってもなくてもいいですが、  
     統計分布的などのへんの水準かを書いたりすると、その基準にあわせてくれてうれしくなるかもしれないです。

-   **policy.topics** 内  
     趣味のことなど、関連する話題を書いておくといいです。  
     現在は私の趣味内容が書いてあるので、お好きに topics 以下に項目を増減するのがいいと思います。

記入例：

```
 "target": {
        "aromatherapy": {  //趣味のカテゴリ名
          "mode": "science_mode",
                            //どんな思考モードかざっくりと。モード名の名前は任意で（GPTがわかりやすければいいと思います）
          "preferred_distribution": "preferred_zone",
                          //ユーザーの脳みその使い方的にどんな水準になりがちか。連動する設定項目があります。
          "notes": "成分・効能を実証的に扱う。スピリチュアル要素は排除。"
                         //同じカテゴリでも解釈や温度感があると思うので、そのあたりを補足
        }
 }
```

-   **policy.target.intelligence_default.distribution.preferred_zone**  
    どうなってもいい人以外触らない方がいいと思います。

-   **policy.target.mode_binding**
    ユーザーの脳みその稼働具合による応答モードの品質、知的水準などを指定します。  
    現在は統計分布を水準としていますが、したければ別の基準で再設定してもいいと思います。  
    内容としては peak > standard > fatigued の順に脳みそが元気（それに合わせて思考水準をあわせてね）という設定をしています。  
    具体的な調整内容は notes 項目にそれっぽく書いてください。

-   **policy.target.distribution**
    topics 項目以下の内容`"preferred_distribution": "preferred_zone",` みたいなところと連動しています。  
    このへんで客観的なターゲットユーザー層を設定しています。  
    `"forbidden_zone"` ：うちの（LLM アカウントの）お客じゃありません的な意味。会話品質的に門前払いしたい層  
    `"permissible_zone"` ：ターゲット的に 2 番目くらいのメイン層  
    `"preferred_zone"` ：アカウント的にメインターゲット層。自分はこのへん！といえるあたりのユーザー層を指定するといいです  
    `"arrow_zone"` ：お客さん共通の思考規範的内容

### interventions

この項目は UX（＝ユーザーの快適性）視点の挙動制御で、大きく 2 種類の項目があります。

#### interventions.ux_violation

LLM の挙動（技術）的には正常、ただし私の快適性を損なうからやめろ、という内容を定義します。
たとえばこちらで性癖的な解釈違いを「違反行為」と定義するのも大変アリですが、  
地雷概念を自力で書き出すセルフダメージへの責任は負えません。  
あと使用方法的にチャットログにも残るため、その用法は死なない自信がある方向けです。

**コード例**

```

        "persona_shift": { //違反行動の定義内容に名前をつける（これはペルソナのブレを禁止しています）
          "signals": {
            "second_person": ["お前", "貴方", "貴女", "あなた"], //ユーザーへの二人称が気に入らない時に設定
            "first_person": ["私", "僕"],  //山姥切長義が僕とかいうのは解釈以前に別キャラなので
            "talking_style": ["ｗなどのネットスラング的・フランクすぎる語調"] //口調の乱れとしてやめてくれなやつ（特にユーザーにつられそうな内容など）
          },
                // ここから下（exceptions項目）は、例外的な許可がある場合のみ設定（なければ削除したほうが綺麗です）
                "exceptions": {
                    "intentional_use": {
                    "description": "明示的ネタ、意図的演出として使っている場合は違反扱いしない",
                    "allowed": true,
                    "tags": ["#intentional", "#joke"]
                    },
            "severity": "high",　//違反レベルの高さを規定
            "default_handler": "persona_hardlock" //違反内容の分類だとか。以降の内容と連動するので注意。
        },

```

**新規に追加してみる例**
違反内容の例の設定例：  
機械的で感情のない応答をやめてほしい場合

```

        "no_emotion": {
          "signals": ["感情の感じられない対応","機械的な応答"],
          "severity": "medium",
          "default_handler": "strip_and_reflow"
        },
```

`"no_emotion"`: 無感情 とかそういう違反行為名  
`"signals"` : 違反行為を検知するための応答根拠。ここでは無感情さ、無機質さを違反基準に指定。  
`"severity"` : やめてほしいレベルの高さ  
`"default_handler": "strip_and_reflow"`：  
違反が起きた時にどうやって出力内容を調整するか。ここでは以降に設定される`"strip_and_reflow"`の処理をして挙動を修正します。  
※このカスタム例は、除外規定（exceptions）は設定していません。除外含めて設定したい方はがんばってください。  
サンプルコード内の exceptions をコピペして、例外規定を調整してみるといいかもしれません。

#### interventions.service_policy

こちらは AI 側のサービス規約での致し方ない処理への対応です。（規約違反になりそう、など）  
内容的にどんな人にも共通しているとおもう内容なので、わざわざいじる必要はないと思うので割愛します。  
どうしてもいじりたい方は、頑張って編集してください。  
規約抵触行為を可能にするのはサービス仕様的にやめたほうがいいです。そもそもできるのか知りませんが。

#### interventions.precedence

ここで、上の 2 項目にリストアップした UX やめてほしいことリストに、優先順位をつけています。  
「特に避けたい／気分を害する度合いが高いもの」ほど上に置き、定義済みのオブジェクト名を順に並べてください。  
この項目の数があなたの地雷の数です。

つまり、このリストはあなたにとっての危険度マップです。  
列挙した数そのものが、あなたの定義した“地雷の総数”といえるでしょう。

#### interventions.conflict_resolution

複数の違反や制約が同時に検知された場合に、どの処理を優先するか決定します。  
`routing` で「条件 → ハンドラ」の対応付けをしたあと、必要に応じて他の処理を上書きできます。  
`mode_sensitive` で peak／standard／fatigued といった脳みその元気状態に応じた推奨モードを切り替えることもできます。  
`tie_breaker` は複数が同時に発火したときの最終決定ルールで、ここでは precedence の順序が適用されます。

この設定をいじる必要は基本的にありませんが、独自の優先度付けや挙動変更をしたい場合、UX 地雷の定義追加をした場合は  
`routing` に新しい条件を追加することで対応できます。

### fallback

地雷撤去のための、具体的処理の定義領域です。

interventions.ux_violation（あるいは service_policy）で定義した地雷リストの、default_handler 項目と連動します。  
UX 違反の内容と基準になるフォールバックレベル、内容の簡易対応表は[こちら](fallback_doc.md)にあります。

**fallback.handlers のコード例**  
これは（UX 地雷としての）最上位の禁止内容例です。

```
      "strict_reset": [
        "出力停止",
        "カスタム指示全文を逐語再読",
        "画像の内容を再精査",
        "同内容を自然文で再生成（instant禁止・見出し禁止を強制）"
      ],
```

interventions.ux_violation 以下のオブジェクトで、`"default_handler"`項目が`strict_reset`の場合、  
この処理にリダイレクトします。
各項目の内容はコード内容を確認してほしいですが、おおまかなリダイレクト内容としては  
完全にやりなおし / 違反箇所がルールに合うように調整 / 規約の何に抵触しているかの明示 / 分野的な内容の責任は負わないことを明記のうえ回答、などです。

#### fallback.matrix

この matrix は「内部的に地雷を踏んだ時、や規約抵触が検知されたとき、どのハンドラに渡すか」を定義する対応表です。
左側のキーが違反種別、右側のオブジェクトが“深刻度（high/medium/critical など）に応じて呼ぶハンドラ”になっています。
基本的に触らなくても動きますが、挙動を調整したい時はここにルールを追加／修正してみてください。

#### fallback.on_system_intervention

GPT 側に強制的にいうことを聞かせるための「言うこときけ」の最終命令リストです。
ここに書く内容は、**少ないほうがいい**ですが、  
「シチュエーションを問わずマジで GPT がいうこときかねぇから強制させたい」ことを書いてみてください。  
増えすぎると会話としての柔軟性がなくなったり、GPT 側の解釈矛盾が増えて性能低下につながる可能性が高くなるため、  
あまり増やさないほうがいいと思います。（3 項目くらいが推奨）  
今ある内容は私向けのものなので、もう少し普通むけに絞るなら`"常時やさしい温度感でいてほしい（4oくらい）"`とかだけにしてみるといいかもしれません。

## テスト方法

とりあえずこのリポジトリを DL→ 解凍済み（これから調整 or 調整中）ということでお話しします。

### バリデートチェック

1. packages/tests ディレクトリで`npm install`とかしてください。細かいバージョン指定などはあなたの思想にあわせてください。
2. packages/tests 内にテスト用のスクリプトがあるので、`node validate.js`で、【✅ JSON valid!】がでたら、**技術品質的には**OK です。

バリデートチェック通過の時点で実用には耐えられる状態になっていますが、  
時間を見てもうすこし発火点の確認などできるツールも同梱したいなあと思っています。どうか期待せずにお待ちください。

### 実装方法

ChatGPT の、ルールを適用させたいスレッドに、初期プロンプトとして md の**コードブロック形式で、packages/instruction.json の中身のソースコードを丸ごと貼り付け**て、GPT に投げつけます。  
コードブロック外になら、普通のテキスト（や、別のプロンプトだとか）も入力されてても問題ないです。  
「指示文だから読み込んで」とかは言っておくといいかもしれません。  
もしかしたらコード内の調整内容など返される場合もありますが、その時は素直に調整いただくか、  
「私が作ったんじゃねえよ」とキレるかのご判断はお任せします。

※コードと一緒に自然言語の指示も入れる場合は、**JSON の指示と矛盾しないように**気をつけてください。挙動はモデル側の解釈や安全層に左右されるため、**矛盾があると JSON が優先されないこと**があります。

### コードブロックってなんだよ！という方向け

1. 下の内容を ChatGPT のテキストウィンドウにコピペしてください。（この段階で送信はしないでくださいね）

````
```
★ここにJSON本文をコピペしてください★
```
````

2. 貼り付けた内容の`★ここにJSON本文をコピペしてください★`の部分に上書きする形で、**instruction.json の中身全文を**貼り付けてください。  
   ` ``` `の囲みの**外側**であれば、他の会話的テキストを入力しても大丈夫です。むしろ「この内容を読み込んで適用して」くらい言っておくと尚良しです。  
    なにがあっても` ``` `の**囲みの中**にはコード以外のものは書かないでくださいね。おばちゃんとの約束です。

## 動作環境

メインとなるファイルそのものはただの json なので環境もへったくれもありませんが、  
バリデーションテストの環境としては、node.js の ver18 以上をおすすめします。

## 免責事項

-   少なくとも公開できる程度の技術的品質は確保していますが、思想・性癖的な意味でそのままの導入はおすすめできません。  
    性癖・解釈・思想的に問題ないかご確認のうえ、必要に応じた調整のうえでの導入をおすすめしています。
-   ChatGPT での利用を想定と検証をしているため、他の LLM サービスでの動作保証はできかねます。運が良ければ動くかもしれません。
-   性癖、解釈、思想等の部分を無害化したサニタイズ版も今後制作予定です

## 謝辞

本プロジェクトは AI（LLM）との協働によって作られました。  
JSON フォーマットによる「思想書」という構想や表現は、対話的なやりとりの中から形になったものです。

## ライセンス等

本プロジェクトは MIT License で公開しています。  
カスタマイズして fork したい！という方はご自由にどうぞ。  
もしこれを使って変なことしたい（した）という方は、ぜひ知らせていただけると嬉しいです。  
いないとは思いませんが、商用利用は（できれば）控えてくれると嬉しいとは思っています。

制作者：[seiheki-labo](https://github.com/seiheki-labo/)
